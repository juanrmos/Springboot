<!DOCTYPE html>
<html lang="es" xmlns:th="http://www.thymeleaf.org">

<head th:replace="layouts/head :: head"></head>

<body>
    <header th:replace="layouts/header :: header"></header>
    
    <div class="container mt-4">
        <h1 th:text="${titulo != null ? titulo : 'Filtrar por Año'}"></h1>

        <!-- Formulario de filtro por año -->
        <div class="card mb-4 mt-4">
            <div class="card-header bg-info text-white">
                <h5 class="mb-0">
                    <i class="bi bi-calendar-range"></i> Filtrar Películas por Año de Estreno
                </h5>
            </div>
            <div class="card-body">
                <!-- Filtro por año específico -->
                <div class="mb-4">
                    <h6 class="text-primary">Buscar por año específico:</h6>
                    <form action="/filtrar-por-ano" method="get" class="row g-3">
                        <div class="col-md-4">
                            <label for="year" class="form-label">Año:</label>
                            <input type="number" 
                                   class="form-control" 
                                   id="year" 
                                   name="year"
                                   th:value="${yearFiltro}"
                                   placeholder="Ej: 2024"
                                   min="1900"
                                   max="2100">
                        </div>
                        <div class="col-md-2 d-flex align-items-end">
                            <button type="submit" class="btn btn-info w-100">
                                <i class="bi bi-funnel"></i> Filtrar
                            </button>
                        </div>
                    </form>
                </div>

                <hr>

                <!-- Filtro por rango de años -->
                <div class="mb-3">
                    <h6 class="text-primary">Buscar por rango de años:</h6>
                    <form action="/filtrar-por-ano" method="get" class="row g-3">
                        <div class="col-md-3">
                            <label for="startYear" class="form-label">Desde el año:</label>
                            <input type="number" 
                                   class="form-control" 
                                   id="startYear" 
                                   name="startYear"
                                   th:value="${startYearFiltro}"
                                   placeholder="Ej: 2020"
                                   min="1900"
                                   max="2100">
                        </div>
                        <div class="col-md-3">
                            <label for="endYear" class="form-label">Hasta el año:</label>
                            <input type="number" 
                                   class="form-control" 
                                   id="endYear" 
                                   name="endYear"
                                   th:value="${endYearFiltro}"
                                   placeholder="Ej: 2024"
                                   min="1900"
                                   max="2100">
                        </div>
                        <div class="col-md-2 d-flex align-items-end">
                            <button type="submit" class="btn btn-info w-100">
                                <i class="bi bi-funnel"></i> Filtrar
                            </button>
                        </div>
                    </form>
                </div>
                
                <div class="mt-3">
                    <a href="/home" class="btn btn-secondary btn-sm">
                        <i class="bi bi-house"></i> Volver al catálogo
                    </a>
                    <a href="/filtrar-por-ano" class="btn btn-warning btn-sm ms-2">
                        <i class="bi bi-arrow-counterclockwise"></i> Limpiar filtros
                    </a>
                </div>
            </div>
        </div>

        <!-- Resultados -->
        <div class="row row-cols-1 row-cols-md-4 g-4 mt-3">
            <!-- Mensaje cuando no hay resultados -->
            <div th:if="${peliculas == null or peliculas.empty}" class="col-12">
                <div class="alert alert-warning" role="alert">
                    <i class="bi bi-exclamation-triangle"></i> 
                    No se encontraron películas para los criterios seleccionados.
                </div>
            </div>
            
            <!-- Tarjetas de películas -->
            <div class="col" th:each="pelicula : ${peliculas}">
                <div class="card h-100 shadow-sm">
                    <!-- Mostrar imagen de la película o por defecto -->
                    <img th:if="${pelicula.imagenUrl != null}" 
                         th:src="@{'/uploads/' + ${pelicula.imagenUrl}}" 
                         class="card-img-top" 
                         th:alt="${pelicula.nombre}"
                         style="height: 300px; object-fit: cover;">
                    <img th:unless="${pelicula.imagenUrl != null}" 
                         th:src="@{/img/movie.png}" 
                         class="card-img-top" 
                         alt="Sin imagen"
                         style="height: 300px; object-fit: cover;">
                    
                    <div class="card-body">
                        <h5 class="card-title" th:text="${pelicula.nombre}"></h5>
                        <p class="card-text">
                            <strong>Género:</strong> 
                            <span class="badge bg-primary" th:text="${pelicula.genero?.nombre}"></span>
                        </p>
                        <p class="card-text">
                            <strong class="text-info">
                                <i class="bi bi-calendar-event"></i> 
                                Año: <span th:text="${#dates.year(pelicula.fechaEstreno)}"></span>
                            </strong>
                        </p>
                        <p class="card-text">
                            <small class="text-muted">
                                Fecha completa: <span th:text="${#dates.format(pelicula.fechaEstreno, 'dd/MM/yyyy')}"></span>
                            </small>
                        </p>
                        
                        <!-- Protagonistas -->
                        <div th:if="${pelicula.protagonistas != null and !pelicula.protagonistas.empty}">
                            <h6 class="mt-3">
                                <i class="bi bi-people"></i> Protagonistas:
                            </h6>
                            <div class="d-flex flex-wrap gap-2">
                                <div th:each="protagonista : ${pelicula.protagonistas}" 
                                     class="catalogo-actor-container">
                                    <div class="catalogo-actor-imagen" 
                                         th:style="'background-image: url(' + ${protagonista.urlImagen} + ');'">
                                    </div>
                                    <small class="catalogo-actor-texto" th:text="${protagonista.nombre}"></small>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Mensaje si no hay protagonistas -->
                        <div th:if="${pelicula.protagonistas == null or pelicula.protagonistas.empty}">
                            <small class="text-muted">Sin protagonistas</small>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Estadísticas de búsqueda -->
        <div th:if="${peliculas != null and !peliculas.empty}" class="mt-4 mb-4">
            <div class="alert alert-info">
                <i class="bi bi-info-circle"></i> 
                Mostrando <strong th:text="${peliculas.size()}">0</strong> película(s)
            </div>
        </div>
    </div>
</body>
</html>