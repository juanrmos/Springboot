<!DOCTYPE html>
<html lang="es" xmlns:th="http://www.thymeleaf.org">
<head th:replace="~{layouts/head :: head}"></head>
<body>
<header th:replace="~{layouts/header :: header}"></header>

<div class="container">
    <!-- Mensajes de éxito o error globales -->
    <div th:if="${success}" class="alert alert-success alert-dismissible fade show mt-3" role="alert">
        <span th:text="${success}"></span>
        <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
    </div>
    
    <div th:if="${error}" class="alert alert-danger alert-dismissible fade show mt-3" role="alert">
        <span th:text="${error}"></span>
        <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
    </div>

    <form th:action="@{/pelicula}" th:object="${pelicula}" method="post" class="col-md-8 offset-md-2">
        <h2 th:text="${titulo}" class="py-4"></h2>

        <!-- Campo oculto para el ID (importante para edición) -->
        <input type="hidden" th:field="*{id}">
        
        <!-- Campo oculto para los IDs de actores -->
        <input type="hidden" id="ids" name="idActores" value="">

        <!-- Nombre -->
        <div class="row mb-3">
            <label for="nombre" class="col-sm-2 col-form-label">Nombre:</label>
            <div class="col-sm-10">
                <input type="text" 
                       class="form-control" 
                       th:classappend="${#fields.hasErrors('nombre')} ? 'is-invalid' : ''"
                       id="nombre" 
                       th:field="*{nombre}">
                <!-- Mensaje de error específico del campo -->
                <div class="invalid-feedback" th:if="${#fields.hasErrors('nombre')}" th:errors="*{nombre}">
                    Error en nombre
                </div>
            </div>
        </div>

        <!-- Fecha Estreno -->
        <div class="row mb-3">
            <label for="fechaEstreno" class="col-sm-2 col-form-label">Fecha de Estreno:</label>
            <div class="col-sm-10">
                <input type="date" 
                       class="form-control" 
                       th:classappend="${#fields.hasErrors('fechaEstreno')} ? 'is-invalid' : ''"
                       id="fechaEstreno" 
                       th:field="*{fechaEstreno}">
                <!-- Mensaje de error específico del campo -->
                <div class="invalid-feedback" th:if="${#fields.hasErrors('fechaEstreno')}" th:errors="*{fechaEstreno}">
                    Error en fecha
                </div>
            </div>
        </div>

        <!-- Género -->
        <div class="row mb-3">
            <label for="genero" class="col-sm-2 col-form-label">Género:</label>
            <div class="col-sm-10">
                <select class="form-select" 
                        th:classappend="${#fields.hasErrors('genero')} ? 'is-invalid' : ''"
                        th:field="*{genero.id}">
                    <option value="">Seleccione un género</option>
                    <option th:each="genero : ${generos}"
                            th:value="${genero.id}"
                            th:text="${genero.nombre}">
                    </option>
                </select>
                <!-- Mensaje de error específico del campo -->
                <div class="invalid-feedback" th:if="${#fields.hasErrors('genero')}" th:errors="*{genero}">
                    Error en género
                </div>
            </div>
        </div>

        <!-- URL de Imagen -->
        <div class="row mb-3">
            <label for="imagenUrl" class="col-sm-2 col-form-label">URL de Imagen:</label>
            <div class="col-sm-10">
                <input type="url" 
                       class="form-control" 
                       th:classappend="${#fields.hasErrors('imagenUrl')} ? 'is-invalid' : ''"
                       id="imagenUrl" 
                       th:field="*{imagenUrl}" >
                <!-- Mensaje de error específico del campo -->
                <div class="invalid-feedback" th:if="${#fields.hasErrors('imagenUrl')}" th:errors="*{imagenUrl}">
                    Error en URL de imagen
                </div>
            </div>
        </div>

        <!-- Actores -->
        <div class="row mb-3">
            <label for="protagonistas" class="col-sm-2 col-form-label">Actores:</label>
            <div class="col-sm-10">
                <select class="form-select" id="protagonistas" onchange="actorSelection(this)">
                    <option value="">Seleccione un actor</option>
                    <option th:each="actor : ${actores}"
                            th:value="${actor.id}"
                            th:text="${actor.nombre}"
                            th:attr="data-url=${actor.urlImagen}">
                    </option>
                </select>
                <small class="form-text text-muted">Seleccione los actores uno por uno.</small>
            </div>
        </div>

        <!-- Contenedor de actores seleccionados -->
        <div id="protagonista_container" class="row mt-3 mb-3"></div>

        <div class="row">
            <div class="col-sm-10 offset-sm-2">
                <button type="submit" class="btn btn-primary me-2">Guardar</button>
                <a href="/home" class="btn btn-secondary">Cancelar</a>
            </div>
        </div>
    </form>
</div>

</body>
</html>